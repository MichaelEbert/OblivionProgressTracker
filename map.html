<!DOCTYPE html>
<html><head>
	<meta charset="UTF-8"/>
	<link rel="icon" type="image/png" href="./favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="css/main.css"/>
	<link rel="stylesheet" type="text/css" href="css/guide.css"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Map — Interactive Oblivion Checklist</title>
</head>
<body>
	<!-- begin topbar-->
<div id="flexTopBar" class="flexTopBar">
	<nav id="topbar" class="topbar">
		<div class="topbarSection icon">
			<a href="https://prclive.run/"><img src="images/prcbanner.png" style="width: 90px;"></a>
			<div class="topbarSublist">
				<a href="https://www.twitch.tv/prclive" class="topbarSection">Twitch</a>
				<a href="https://www.youtube.com/c/prclive" class="topbarSection">YouTube</a>
				<a href="https://discord.gg/eudsps7" class="topbarSection">Discord</a>
				<a href="https://github.com/MichaelEbert/OblivionProgressTracker" class="topbarSection">GitHub</a>
				<a href="https://twitter.com/_prclive" class="topbarSection">Twitter</a>
			</div>
		</div>
		<div class="topbarSection">
			<a href="./speedrun-guide.html">Guide</a>
			<div class="topbarSublist">
				<a href="./speedrun-guide.html">Speedrun Guide</a>
				<a href="./casual.html">Casual Guide</a>
				<a href="./speedrun-archive.html">Archive</a>
			</div>
		</div>

		<a href="./checklist.html" class="topbarSection">Checklist</a>

		<div class="topbarSection">
			<a href="./map.html">Map</a>
			<div class="topbarSublist">
				<a href="./nirnroute.html">Nirnroute</a>
			</div>
		</div>

		<div class="topbarSection">
			<a href="https://prclive.run/wiki/Oblivion:Tools/Resources">Wiki/Tools</a>
			<div class="topbarSublist">
				<a href="https://prclive.run/wiki/Main_Page">Wiki</a>
				<a href="./tools/tools.html">Tools</a>
				<a href="https://prclive.run/wiki/Oblivion:Glitches/Tech">Glitches</a>
				<a href="https://prclive.run/wiki/Oblivion:Tools/Resources">Tools/Resources Directory</a>
			</div>
		</div>

		<a href="./settings.html" class="topbarSection icon" style="font-size: 0.85em;" title="Settings">⚙️</a>

		<div class="topbarSection"><span class="totalProgressPercent">0</span>%</div> 
	</nav>
</div>
<!-- end topbar-->
<div class="contentContainer">
<div class="mapContainer mainPanel noScroll" id="mapContainer">
	<div class="mapButtonBar">
		<label title="Shows all Locations that need to be discovered."><input type="checkbox" name="icon_selection" id="button_Location" checked >Locations</label>
		<label title="Shows where all Nirnroot are in the overworld."><input type="checkbox" name="icon_selection" id="button_Nirnroot"/>Nirnroots</label>
		<label title="Shows where all Wayshrines are in the overworld."><input type="checkbox" name="icon_selection" id="button_Wayshrine"/>Wayshrines/Heaven Stones</label>
		<label title="Shows gates that can be seen from each location."><input type="checkbox" name="icon_selection" id="button_NearbyGates"/>Nearby Gates</label>
		<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
		<button id="showSettingsButton">Show Settings</button>
		<button id="helpButton">Help!</button>
		<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
		<span>Random gates found: 
			<span id="randomGateCount">##</span> 
		</span>
		<span>Places found: 
			<span id="overview_location">##</span> 
		</span>

		
	</div>
	<div id="mapSettingsContainer" style="display:none">
		<label><input type="radio" name="tsp_selection" id="button_tspNone" title="The fastest way to visit each location" checked/>No TSP</label>
		<label><input type="radio" name="tsp_selection" id="button_tspLocation" title="The fastest way to visit each location"/>Location TSP</label>
		<label><input type="radio" name="tsp_selection" id="button_tspNirnroot" title="The fastest way to visit each nirnroot"/>Nirnroot TSP</label>
		<br/>
		<label><input type="checkbox" id="mapShowPrediscovered" class="autosetting">Show prediscovered locations</label>
		<label><input type="checkbox" id="mapShowDistanceCheck" class="autosetting">Show distance between locations</label>
		<label><input type="checkbox" id="mapShowFormId" class="autosetting">Show formID on map</label>
		<br/>
		<button id="resetMapButton">Reset Map</button>
	</div>
	<div id="help" style="display:none; height: 350vh; overflow: scroll; overflow-x: hidden;">
		<h2>FAQ</h2>
		<h3>How to Use the Map</h3>
		<p>Click on undiscovered (light icon) places to mark them as discovered (dark icon). Hover over a location to see its name. You can use the mouse wheel to zoom in/out, and click to drag the map around while viewing it.</p>
		<p>There are several other objectives tracked by this map:</p>
		<ul>
			<li><b>Oblivion Gates</b> can be discovered, but also need to be closed. Left clicking again on a discovered gate will give it a checkmark to indicate it is closed. See the next section for more info on how gates work.</li>
			<li><b>Nirnroots</b> need to be harvested. Click on them to give them a checkmark indicating you have harvested them. For this task, the Nirnroute version of the map in the dropdown for the Map page is highly recommended.</li>
			<li><b>Wayshrine</b> blessings need to be obtained by activating a Wayshrine when you have at least 1 Fame. There are several copies of each Wayshrine around the map, but you only need each blessing from one copy, so clicking on one copy will check all of that Wayshrine off.</li>
			<li><b>Heaven Stones</b> each give you a Greater Power when activated between 6pm and 6am when your combined Fame and Infamy is high enough. Click on a Heaven Stone to give it a checkmark to indicate you have received that stone's Greater Power.</li>
		</ul>
		<p><i>For routers, right-clicking will select a location and highlight it green. Hovering a different location while another is selected will display the distance between those locations as long as the "Show distance between locations" box is checked.</i></p>
		
		<h3>Oblivion Gates</h3>
		<p>Oblivion Gates need to be discovered and also closed. Click on an already discovered gate to mark it as closed with a checkmark.</p>
		<p>Oblivion Gates may have up to 3 letters on their icon. Here is what they mean:</p>
		<ul>
		<li><img style="float:unset" height="24" src="images/Icon_Overlay_Fixed.png"> — These gates are <b>Fixed</b>, meaning they will always appear in that location every playthrough.</li>
		<li><img style="float:unset" height="24" src="images/Icon_Overlay_No_Reroll.png"> — These gates have the same layout (<b>No Re-roll</b>) every time you enter them instead of being randomly generated.</li>
		<li><img style="float:unset" height="24" src="images/Icon_Overlay_Two_Fame.png"> — These gates give <b>2 Fame</b> instead of one.</li>
		</ul>
		<h4>Gate Closing Strategy</h4>
		<p>Gates that are not Fixed are <b>Random Gates</b>, which start appearing more and more frequently as you go through the main quest. Of all the locations on the map, only <b>40 Random Gates</b> can be discovered before they stop appearing, at which point this map will grey out the remaining icons. The Fixed Gates each appear after a specific main quest has been completed.</p>
		<p>In general, <b>this is the best strategy for casual players:</b></p>
		<ol>
			<li>Complete the Dagon Shrine main quest. Random Gates will now appear as often as possible, and all but 2 Fixed Gates will appear.</li>
			<li>Discover/close all 40 Random Gates, and every Fixed Gate except for the Bruma Fixed Gate, and the Great Gate (not on the map).</li>
			<li>As you complete the main quest, you will get the two remaining gates during the Bruma Gate and Great Gate quests respectively.</li>
		</ol>

		<h3>What is TSP?</h3>
		<p>Located via the "Show Settings" button, The Traveling Salesman Path (TSP) is mathematically optimized to be the fastest route to discover all the places. The path loops, so you can start anywhere. As long as you only go one direction, you will get everything on the path. <b>The Location TSP is primarily for speedrunners and doesn't include most Oblivion Gates and other side objectives as result of route logic.</b></p>
	</div>

	<div id="wrapper_Map" class="mapWrapper"></div>
</div>
</div>
<script type="module">
	//normally, we can't call module code from non-module code.
	//exportNamespace appends everything to window, so it can be called like normal js code.
	import exportNamespace from './js/module-shim.mjs'
	import * as userdata from './js/userdata.mjs'
	import * as map from './js/map.mjs';
	import * as point from './js/map/point.mjs';
	import * as obliviondata from './js/obliviondata.mjs';
	import * as sharing from './js/sharing.mjs';
	import * as progress from './js/progressCalculation.mjs';
	
	window.mapjs = map;

	if(userdata.loadCookie("debug") == true){
		window.debug = true;
	}
	document.getElementById("helpButton").addEventListener('click',function (){
		const button = document.getElementById("helpButton");
		const helpWindow = document.getElementById("help");
		if(button.innerText == "Help!"){
			helpWindow.style.display = "unset";
			button.innerText = "Hide Help"
		}
		else{
			helpWindow.style.display = "none";
			button.innerText = "Help!"
		}
	});

	var additionalSettingsShown = false;

	window.showHideMapSettings = function(){
		const mapSettingsContainer = document.getElementById("mapSettingsContainer");
		const showHideButton = document.getElementById("showSettingsButton");
		if(!additionalSettingsShown){
			mapSettingsContainer.style.display = "unset";
			showHideButton.innerText = "Hide Settings"
			additionalSettingsShown = true;
		}
		else{
			mapSettingsContainer.style.display = "none";
			showHideButton.innerText = "Show Settings";
			additionalSettingsShown = false;
		}
	};

	(function(){
		document.getElementById("showSettingsButton").addEventListener('click', showHideMapSettings);

		obliviondata.loadJsonData().then(()=>{
			userdata.loadProgressFromCookie();
			map.initMap();
			//need to add events to redraw immediately upon change
			//TODO fix. or move all this stuff into another js file.  or something.
			document.getElementById("mapShowPrediscovered").addEventListener('change',()=>{map.draw();});
			progress.recalculateProgress();

			if(settings.remoteShareCode){
				if(!document.getElementById("spectateBanner") && document.getElementById("topbar") != null){
					let spectateBanner = sharing.createSpectateBanner();
					document.getElementById("flexTopBar").insertBefore(spectateBanner, document.getElementById("flexTopBar").firstChild);
				}
			}
		});
	}).call(window);

</script>
</body>
</html>