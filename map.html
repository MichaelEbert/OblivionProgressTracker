<!DOCTYPE html>
<html><head>
	<meta charset="UTF-8"/>
	<link rel="icon" type="image/png" href="./favicon.ico"/>
	<link rel="stylesheet" type="text/css" href="css/main.css"/>
	<link rel="stylesheet" type="text/css" href="css/guide.css"/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Map — Interactive Oblivion Checklist</title>
</head>
<body>
	<!-- begin topbar-->
<div id="flexTopBar" class="flexTopBar">
	<nav id="topbar" class="topbar">
		<div class="topbarSection icon">
			<a href="https://prclive.run/"><img src="images/prcbanner.png" style="width: 90px;"></a>
			<div class="topbarSublist">
				<a href="https://www.twitch.tv/prclive" class="topbarSection">Twitch</a>
				<a href="https://www.youtube.com/c/prclive" class="topbarSection">YouTube</a>
				<a href="https://discord.gg/eudsps7" class="topbarSection">Discord</a>
				<a href="https://github.com/MichaelEbert/OblivionProgressTracker" class="topbarSection">GitHub</a>
				<a href="https://twitter.com/_prclive" class="topbarSection">Twitter</a>
			</div>
		</div>
		<div class="topbarSection">
			<a href="./speedrun-guide.html">Guide</a>
			<div class="topbarSublist">
				<a href="./speedrun-guide.html">Speedrun Guide</a>
				<a href="./casual.html">Casual Guide</a>
				<a href="./speedrun-archive.html">Archive</a>
			</div>
		</div>

		<a href="./checklist.html" class="topbarSection">Checklist</a>

		<div class="topbarSection">
			<a href="./map.html">Map</a>
			<div class="topbarSublist">
				<a href="./nirnroute.html">Nirnroute</a>
			</div>
		</div>

		<div class="topbarSection">
			<a href="https://prclive.run/wiki/Oblivion:Tools/Resources">Wiki/Tools</a>
			<div class="topbarSublist">
				<a href="https://prclive.run/wiki/Main_Page">Wiki</a>
				<a href="./tools/tools.html">Tools</a>
				<a href="https://prclive.run/wiki/Oblivion:Glitches/Tech">Glitches</a>
				<a href="https://prclive.run/wiki/Oblivion:Tools/Resources">Tools/Resources Directory</a>
			</div>
		</div>

		<a href="./settings.html" class="topbarSection icon" style="font-size: 0.85em;" title="Settings">⚙️</a>

		<div class="topbarSection"><span class="totalProgressPercent">0</span>%</div> 
	</nav>
</div>
<!-- end topbar-->
<div class="contentContainer">
<div class="mapContainer" id="mapContainer">
	<div class="mapButtonBar">
		<label title="Shows all Locations that need to be discovered."><input type="checkbox" name="icon_selection" id="button_Location" checked >Locations</label>
		<label title="Shows where all Nirnroot are in the overworld."><input type="checkbox" name="icon_selection" id="button_Nirnroot"/>Nirnroots</label>
		<label title="Shows where all Wayshrines are in the overworld."><input type="checkbox" name="icon_selection" id="button_Wayshrine"/>Wayshrines/Heaven Stones</label>
		<label title="Shows gates that can be seen from each location."><input type="checkbox" name="icon_selection" id="button_NearbyGates"/>Nearby Gates</label>
		<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
		<button id="showSettingsButton">Show Settings</button>
		<button id="helpButton">Help!</button>
		<span>&nbsp;&nbsp;|&nbsp;&nbsp;</span>
		<span>Random gates found: 
			<span id="randomGateCount">##</span> 
		</span>
		<span>Places found: 
			<span id="overview_location">##</span> 
		</span>

		
	</div>
	<div id="mapSettingsContainer" style="display:none">
		<label><input type="radio" name="tsp_selection" id="button_tspNone" title="The fastest way to visit each location" checked/>No TSP</label>
		<label><input type="radio" name="tsp_selection" id="button_tspLocation" title="The fastest way to visit each location"/>Location TSP</label>
		<label><input type="radio" name="tsp_selection" id="button_tspNirnroot" title="The fastest way to visit each nirnroot"/>Nirnroot TSP</label>
		<br/>
		<label><input type="checkbox" id="mapShowPrediscovered" class="autosetting">Show prediscovered locations</label>
		<label><input type="checkbox" id="mapShowDistanceCheck" class="autosetting">Show distance between locations</label>
		<label><input type="checkbox" id="mapShowFormId" class="autosetting">Show formID on map</label>
		<br/>
		<button id="resetMapButton">Reset Map</button>
	</div>
	<div id="help" style="display:none">
		<h2>FAQ</h2>
		<h3>How to use?</h3>
		<p>Click on an icon to toggle its state between discovered/undiscovered. right-click to select.</p>
		<h3>Oblivion gate key</h3>
		<p>Oblivion gates have 3 states: Undiscovered, Discovered (checked), and Closed (red).</p>
		<p>Oblivion gates may have up to 3 letters on their icon. Here is what they mean:
		<ul>
		<li><img style="float:unset" height="24" src="images/Icon_Overlay_Fixed.png">Fixed location (gate will always appear here)</li>
		<li><img style="float:unset" height="24" src="images/Icon_Overlay_No_Reroll.png">No reroll (Oblivion layout is fixed and cannot be rerolled)</li>
		<li><img style="float:unset" height="24" src="images/Icon_Overlay_Two_Fame.png">Get 2 fame for closing this gate</li>
		</ul></p>
		<h3>What is TSP?</h3>
		<p>The Traveling Salesman Path (TSP) is a calculated fastest route between each icon,
			 it doesn't have to be done in order and it loops so you can start anywhere, and as long as you only go one direction, you will get everything on the path.</p>

		<h3>Why are the icon positions different from in-game?</h3>
		<p>On this web map, the icons are centered on the exact locations that they are in the oblivion world. 
			In other words, if you go to the center of the icon on this map, you'll be at the exact location of the marker.</p>
		<p>When you are plaing Oblivion in-game, all icons are offset slightly to the right, which is confusing.</p>

		<h3>How do random gates work?</h3>
		<p>You need to only discover 40 random oblivion gates. 
			Once you discover 40, the map will automatically grey out the remaining random gate locations on the map, but not on the checklist.</p>
	</div>

	<div id="wrapper_Map" class="mapWrapper"></div>
</div>
</div>
<script type="module">
	//normally, we can't call module code from non-module code.
	//exportNamespace appends everything to window, so it can be called like normal js code.
	import exportNamespace from './js/module-shim.mjs'
	import * as userdata from './js/userdata.mjs'
	import * as map from './js/map.mjs';
	import * as point from './js/map/point.mjs';
	import * as obliviondata from './js/obliviondata.mjs';
	import * as sharing from './js/sharing.mjs';
	import * as progress from './js/progressCalculation.mjs';
	
	window.mapjs = map;

	if(userdata.loadCookie("debug") == true){
		window.debug = true;
	}
	document.getElementById("helpButton").addEventListener('click',function (){
		const button = document.getElementById("helpButton");
		const helpWindow = document.getElementById("help");
		if(button.innerText == "Help!"){
			helpWindow.style.display = "unset";
			button.innerText = "Hide Help"
		}
		else{
			helpWindow.style.display = "none";
			button.innerText = "Help!"
		}
	});

	var additionalSettingsShown = false;

	window.showHideMapSettings = function(){
		const mapSettingsContainer = document.getElementById("mapSettingsContainer");
		const showHideButton = document.getElementById("showSettingsButton");
		if(!additionalSettingsShown){
			mapSettingsContainer.style.display = "unset";
			showHideButton.innerText = "Hide Settings"
			additionalSettingsShown = true;
		}
		else{
			mapSettingsContainer.style.display = "none";
			showHideButton.innerText = "Show Settings";
			additionalSettingsShown = false;
		}
	};

	(function(){
		document.getElementById("showSettingsButton").addEventListener('click', showHideMapSettings);

		obliviondata.loadJsonData().then(()=>{
			userdata.loadProgressFromCookie();
			map.initMap();
			//need to add events to redraw immediately upon change
			//TODO fix. or move all this stuff into another js file.  or something.
			document.getElementById("mapShowPrediscovered").addEventListener('change',()=>{map.draw();});
			progress.recalculateProgress();

			if(settings.remoteShareCode){
				if(!document.getElementById("spectateBanner") && document.getElementById("topbar") != null){
					let spectateBanner = sharing.createSpectateBanner();
					document.getElementById("flexTopBar").insertBefore(spectateBanner, document.getElementById("flexTopBar").firstChild);
				}
			}
		});
	}).call(window);

</script>
</body>
</html>